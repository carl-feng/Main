#!/bin/bash

cd /root/Main

if [ -e "/root/Main/version.txt" ]; then

    flag=`git pull | grep "Updating" | wc -l`
    if [ $flag = "1" ]; then
        echo "[`date`] need update" >> /root/update.log
        /usr/bin/killall watchdog Main captureService testOnDemandRTSPServer
        /bin/bash postUpdate
        /usr/bin/make
        /bin/sync
        /sbin/reboot
    else
        echo "[`date`] no update" >> /root/update.log
    fi
else
    echo "[`date`] no version.txt, skip update" >> /root/update.log
fi

if [ ! -e "/etc/cron.hourly/syncDate" ]; then
    cp /root/Main/syncDate /etc/cron.hourly/
    echo "copy syncDate file success".
fi
